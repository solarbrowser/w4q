<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quanta JavaScript Engine</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo" style="text-decoration: none; color: var(--text-color);">quanta</a>
            <div class="header-right">
                <button class="hamburger-menu" id="hamburgerMenu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <nav id="navMenu">
                    <a href="pages/blog/blog.html">blog</a>
                    <a href="pages/docs/docs.html">docs</a>
                    <a href="pages/test262/test262.html">test262</a>
                    <a href="https://github.com/solarbrowser/quanta">github</a>
                </nav>
                <button class="theme-switcher" id="themeSwitcher" title="Change theme">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2"/>
                        <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2"/>
                        <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2"/>
                        <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="welcome">
            <h2>Welcome!</h2>
            <p>
                Quanta is a spec-first JavaScript engine written in C++.
                It is built to explore how JavaScript actually works beneath the surface, not how fast it can run, 
                but how precisely it follows the ECMAScript specification. The project emphasizes correctness, 
                explicit semantics, and test-driven validation using the official Test262 suite.
            </p>
        </section>

        <section class="features">
            <h3>What's New</h3>
            <ul class="news-list" id="homeNewsList">
                <li>Loading latest posts...</li>
            </ul>
            <p class="read-more">
                Read more in the <a href="pages/blog/blog.html">Quanta Blog</a>
            </p>
        </section>
    </main>

    <script src="script.js"></script>
    <script>
        async function loadLatestPosts() {
            try {
                const indexResponse = await fetch('pages/blog/posts/index.json');
                const files = await indexResponse.json();
                
                const posts = [];
                for (const filename of files) {
                    try {
                        const response = await fetch(`pages/blog/posts/json/${filename}`);
                        const post = await response.json();
                        posts.push(post);
                    } catch (e) {
                        console.log(`Could not load ${filename}`);
                    }
                }
                
                posts.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const listElement = document.getElementById('homeNewsList');
                if (posts.length === 0) {
                    listElement.innerHTML = '<li>No posts available.</li>';
                    return;
                }
                
                let html = '';
                posts.slice(0, 5).forEach(post => {
                    html += `
                        <li>
                            <span class="date">${post.date}</span>
                            <a href="pages/blog/post.html?id=${post.id}" class="news-link">${post.title}</a>
                        </li>
                    `;
                });
                
                listElement.innerHTML = html;
            } catch (e) {
                document.getElementById('homeNewsList').innerHTML = '<li>Could not load posts.</li>';
            }
        }
        
        loadLatestPosts();
    </script>

    <footer>
        <div class="container">
            <div class="footer-left">
                built with ♡ in Istanbul by Ata Türkçü
            </div>
            <div class="footer-right">
                <a href="https://github.com/solarbrowser/quanta" target="_blank" class="github-badge">
                    <span class="github-badge-label">Stars</span>
                    <span class="github-badge-value" id="starCount">0</span>
                </a>
                <div class="github-badge">
                    <span class="github-badge-label">Last Commit</span>
                    <span class="github-badge-value" id="lastCommit">0m ago</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        async function loadGitHubStats() {
            try {
                const repoResponse = await fetch('https://api.github.com/repos/solarbrowser/quanta');
                const repoData = await repoResponse.json();
                document.getElementById('starCount').textContent = repoData.stargazers_count;

                const commitsResponse = await fetch('https://api.github.com/repos/solarbrowser/quanta/commits?per_page=1');
                const commitsData = await commitsResponse.json();
                const lastCommitDate = new Date(commitsData[0].commit.author.date);
                const now = new Date();
                const diffMs = now - lastCommitDate;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                let timeAgo;
                if (diffMins < 60) {
                    timeAgo = diffMins === 0 ? 'just now' : `${diffMins}m ago`;
                } else if (diffHours < 24) {
                    timeAgo = `${diffHours}h ago`;
                } else if (diffDays === 1) {
                    timeAgo = 'yesterday';
                } else if (diffDays < 7) {
                    timeAgo = `${diffDays}d ago`;
                } else {
                    timeAgo = lastCommitDate.toLocaleDateString();
                }

                document.getElementById('lastCommit').textContent = timeAgo;
            } catch (e) {
                console.error('Error loading GitHub stats:', e);
                document.getElementById('starCount').textContent = '-';
                document.getElementById('lastCommit').textContent = '-';
            }
        }

        loadGitHubStats();
    </script>
</body>
</html>
